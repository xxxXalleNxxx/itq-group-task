# Запуск проекта

## 1. Запуск PostgreSQL
docker-compose up -d

## 2. Запуск приложения
mvn spring-boot:run

генератор документов стартует сразу с запуском, если нет, то добавить '--generate' в Programm Arguments (run -> edit configurations)

---

# Эндпоинты

| Метод | URL | Описание |
|-------|-----|----------|
| POST | /api/documents | Создать документ |
| GET | /api/documents/{id} | Получить документ с историей |
| POST | /api/documents/batch | Получить документы по пачке ID |
| POST | /api/documents/submit | Отправить на согласование |
| POST | /api/documents/approve | Утвердить документы |
| GET | /api/documents/search | Поиск документов |
| POST | /api/test/{id} | Тест конкурентности |

---

## Примеры запросов

### Создание документа
POST /api/documents
{
    "author": "Арапов",
    "title": "Годовой отчет",
    "initiator": "Петров П.П."
}

### Получение документа
GET /api/documents/1

### Отправка на согласование
POST /api/documents/submit
{
    "ids": [1, 2, 3],
    "initiator": "Арапов",
    "comment": "На проверку"
}

### Утверждение документов
POST /api/documents/approve
{
    "ids": [1, 2, 3],
    "initiator": "Директор",
    "comment": "Утверждено"
}

### Поиск документов
GET /api/documents/search?status=DRAFT&author=Арапов&page=0&size=10

### Тест конкурентности
POST /api/test/1?threads=5&attempts=3

---

# Логирование

### Генератор документов
[5/10] Документ создан. ID: 5, Номер: DOC-20260220-D4E5F6G7, Время: 120 мс  
ПРОГРЕСС: 50% (5/10)  
=== ГЕНЕРАЦИЯ ЗАВЕРШЕНА ===  
Создано: 10/10 документов, Время: 1500 мс

### При работе воркеров
=== SUBMIT WORKER ЗАПУЩЕН ===  
Всего документов в статусе DRAFT: 150  
Пакет #1: обработка 100 документов (100 из 150)  
Пакет #1 завершен. Успешно: 98, Конфликтов: 2, Время: 2345 мс  
Прогресс: 150/150 (100%)  
=== SUBMIT WORKER ЗАВЕРШЕН ===  
Итого обработано: 150 документов, Время: 3579 мс

=== APPROVE WORKER ЗАПУЩЕН ===
Всего документов в статусе SUBMITTED: 75  
Пакет #1: обработка 75 документов (75 из 75)  
Пакет #1 завершен. Успешно: 73, Конфликтов: 2, Время: 1890 мс  
Прогресс: 75/75 (100%)  
=== APPROVE WORKER ЗАВЕРШЕН ===  
Итого обработано: 75 документов, Время: 1890 мс

### При пакетной обработке через API
Пакетная отправка на согласование. Количество документов: 4, Инициатор: arapov  
Документ 1 успешно отправлен на согласование  
Документ 2 успешно отправлен на согласование  
Недопустимый переход статуса. Документ ID: 3, Текущий статус: APPROVED, Ожидаемый: DRAFT  
Ошибка при обработке документа 9999: Документ не найден  
Пакетная отправка завершена. Всего: 4, Успешно: 2, Время: 15 мс

---

# Примечания

### -Уникальный номер документа формат DOC-yyyyMMdd-UUID(8 символов)
### -Количество документов для генерации внутри 'generator.properties'  в корне проекта
### -Если будет проблема с валидацией при миграции, то снести полностью все таблицы, поменять dll-auto на null, запустить приложение, потом поменять обратно на validate
